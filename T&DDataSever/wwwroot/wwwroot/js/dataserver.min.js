/*
 * Copyright (C) T&D Corporation
 *
 * TANDD Dataserver Viewer
 */

!function(a){var b={};a.TANDD=b,b.env={version:"0.2.1"},b.util={},b.products={},b.comm={},function(){function a(){var a,c=48,c=0,d=0,e=window.innerHeight>window.innerWidth;if(window.webview||window.navigator.standalone)a=window.innerHeight-c,d=window.innerWidth;else if(b.env.ua.isAndroidDefaultBrowser){var f=window.outerHeight/window.devicePixelRatio-window.innerHeight;a=window.innerHeight-(c+f),d=window.innerWidth}else b.env.ua.isiPad?(a=window.innerHeight-c,d=window.innerWidth):b.env.ua.isiPhone||b.env.ua.isiPodTouch?(a=window.innerHeight-c,d=window.innerWidth):(a=window.innerHeight-c,d=window.innerWidth);return{isPortrait:e,width:d,height:a}}function c(){try{var a=navigator.browserLanguage||navigator.language||navigator.userLanguage;return a.substring(0,2)}catch(b){return}}var d=navigator.userAgent,e=!!d.match(/iPhone/i),f=!!d.match(/iPad/i),g=!!d.match(/iPod/i),h=e||f||g,i=!!d.match(/android/i),j=!!d.match(/Windows Phone/i),k=!!d.match(/MSIE/),l=!!d.match(/Firefox/),m=!!d.match(/Chrome/i)||!!d.match(/CrMo/)||!!d.match(/CriOS/),n=!i&&!!d.match(/Safari/i)&&!m,o=!!d.match(/Opera/i),p=i&&!!d.match(/Safari/i)&&!m,q=!!(e||j||p&&d.match(/Mobile/)||i&&m&&d.match(/Mobile/)||d.match(/Opera Mobi/i)),r=function(){return{lte_IE6:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.documentElement.style.maxHeight,lte_IE7:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.querySelectorAll,lte_IE8:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.getElementsByClassName,lte_IE9:document.uniqueID&&"undefined"==typeof window.matchMedia,gte_IE10:document.uniqueID&&window.matchMedia,eq_IE8:document.uniqueID&&8===document.documentMode,eq_IE9:document.uniqueID&&9===document.documentMode,eq_IE10:document.uniqueID&&10===document.documentMode,eq_IE11:document.uniqueID&&11===document.documentMode,Trident:document.uniqueID}}();b.env.ua={string:d,isIE:k,isiPhone:e,isiPad:f,isiPodTouch:g,isiOS:h,isAndroid:i,isWindowsPhone:j,isFirefox:l,isChrome:m,isSafari:n,isOpera:o,isAndroidDefaultBrowser:p,isSmartPhone:q,ie:r},b.env.getDisplaySize=a,b.env.getLanguage=c}(),b.util.date={},function(){function a(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0);var d=new Date;return d.setTime(1e3*(parseFloat(a)+60*parseFloat(b)+60*parseFloat(c))),d}function c(a,b,c){"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0);var d=new Date(a.getTime());d.setTime(a.valueOf()+1e3*(60*parseFloat(b)+60*parseFloat(c)));var e=d.getUTCFullYear(),f=d.getUTCMonth()+1<10?"0"+(d.getUTCMonth()+1):d.getUTCMonth()+1,g=d.getUTCDate()<10?"0"+d.getUTCDate():d.getUTCDate(),h=d.getUTCHours()<10?"0"+d.getUTCHours():d.getUTCHours(),i=d.getUTCMinutes()<10?"0"+d.getUTCMinutes():d.getUTCMinutes(),j=d.getUTCSeconds()<10?"0"+d.getUTCSeconds():d.getUTCSeconds();return e+"-"+f+"-"+g+" "+h+":"+i+":"+j}function d(b,d,e){"undefined"==typeof d&&(d=0),"undefined"==typeof e&&(e=0);var f=a(b,d,e);return c(f)}function e(){var a=new Date,b=60*(a.getHours()-a.getUTCHours()),c=a.getMinutes()-a.getUTCMinutes();return b+c}b.util.date.unixtime2Date=a,b.util.date.getDateString=c,b.util.date.unixtime2DateString=d,b.util.date.getTZoff=e}(),b.products={},function(){function a(a){var b=parseInt(a,16)>>17&127;return b}function c(b){var c=b.substring(0,1);return"E"===c?e.espec[a(b)]:"3"===c||"4"===c||"6"===c?e.global[a(b)]:e.jp[a(b)]}var d={RTR501:92,RTR502:93,RTR503:94,RTR505:97,RTR507:99,RTR574:96,RTR576:98,RTR500:77,RTR500NW:78,RTR500AW:80,RTR500MBS:81,RTR500GSM:79,RTR500DC:41,TR701NW:56,TR701AW:57,TR702NW:58,TR702AW:59,TR71UI:0,TR72UI:1,TR74UI:5,TR77UI:4,TR71WF:9,TR72WF:10,TR75WF:13,TR71NW:11,TR72NW:12,TR75NW:14,TR51I:19,TR52I:20,TR55I:21,TR41:22,TR42:23,TR45:24,TR71WB:26,TR72WB:27,TR75WB:28};b.products.MODEL_CODE=d;var e={jp:{},global:{},espec:{}};e.jp[d.RTR501]="RTR-501",e.jp[d.RTR502]="RTR-502",e.jp[d.RTR503]="RTR-503",e.jp[d.RTR505]="RTR-505",e.jp[d.RTR507]="RTR-507",e.jp[d.RTR574]="RTR-574",e.jp[d.RTR576]="RTR-576",e.jp[d.RTR500]="RTR-500C",e.jp[d.RTR500NW]="RTR-500NW",e.jp[d.RTR500AW]="RTR-500AW",e.jp[d.RTR500MBS]="RTR-500MBS",e.jp[d.RTR500GSM]="RTR-500GSM",e.jp[d.RTR500DC]="RTR-500DC",e.jp[d.TR701NW]="TR-701NW",e.jp[d.TR701AW]="TR-701AW",e.jp[d.TR702NW]="TR-702NW",e.jp[d.TR702AW]="TR-702AW",e.jp[d.TR71UI]="TR-71Ui",e.jp[d.TR72UI]="TR-72Ui",e.jp[d.TR74UI]="TR-74Ui",e.jp[d.TR77UI]="TR-77Ui",e.jp[d.TR71WF]="TR-71wf",e.jp[d.TR72WF]="TR-72wf",e.jp[d.TR75WF]="TR-75wf",e.jp[d.TR71NW]="TR-71nw",e.jp[d.TR72NW]="TR-72nw",e.jp[d.TR75NW]="TR-75nw",e.jp[d.TR51I]="TR-51i",e.jp[d.TR52I]="TR-52i",e.jp[d.TR55I]="TR-55i",e.jp[d.TR41]="TR41",e.jp[d.TR42]="TR42",e.jp[d.TR45]="TR45",e.jp[d.TR71WB]="TR-71wb",e.jp[d.TR72WB]="TR-72wb",e.jp[d.TR75WB]="TR-75wb";for(var f in e.jp)e.global[f]=e.jp[f];e.global[d.RTR500]="RTR-500",e.espec[d.RTR501]="RTW-21S",e.espec[d.RTR502]="RTW-31S",e.espec[d.RTR503]="RSW-21S",e.espec[d.RTR505]="RUW-21",e.espec[d.RTR574]="RSW-13L",e.espec[d.RTR500]="RT-23BW",e.espec[d.RTR500NW]="RT-23BN",e.espec[d.RTR500AW]="RT-23BM",e.espec[d.RTR500DC]="RTC-22",e.espec[d.TR701NW]="RT-13N",e.espec[d.TR701AW]="RT-13M",e.espec[d.TR702NW]="RS-13N",e.espec[d.TR702AW]="RS-13M",e.espec[d.TR71UI]="RT-13",e.espec[d.TR72UI]="RS-13",e.espec[d.TR74UI]="RS-13L",e.espec[d.TR77UI]="RS-13H",e.espec[d.TR71WF]="RT-14",e.espec[d.TR72WF]="RS-14",e.espec[d.TR71NW]="RT-14N",e.espec[d.TR72NW]="RS-14N",e.espec[d.TR51I]="RT-23S",e.espec[d.TR52I]="RT-32S",b.products.getModelCode=a,b.products.getModelName=c}(),b.comm.ws={},function(){function a(a,b){var c=d(a);if("undefined"!=typeof c){var e={lid:a,pwd:b},f=c+"?"+(new Date).getTime(),g=$.extend({},$.ajaxSettings,{type:"POST",url:f,dataType:"json",data:e,timeout:5e3}),h=$.ajax(g),i=$.Deferred();return h.done(function(a,b,c){i.resolveWith(this,arguments)}),h.fail(function(a,b,c){i.rejectWith(this,arguments)}),h.always(function(){}),$.extend({},h,i.promise())}}function c(a,b,c,g,h){var i=d(a);if("undefined"!=typeof i){var j={lid:a,pwd:b,bsn:c,rsn:g,typ:"csv"},k=i+"?"+(new Date).getTime(),l=$.extend({},$.ajaxSettings,{type:"POST",url:k,dataType:"json",data:j,timeout:5e3}),m=$.ajax(l),n=$.Deferred();return m.done(function(a,b,c){a.code===f.SUCCESS&&(arguments[0].data=e(a,h)),n.resolveWith(this,arguments)}),m.fail(function(a,b,c){n.rejectWith(this,arguments)}),m.always(function(){}),$.extend({},m,n.promise())}}function d(a){return"string"==typeof a&&a.length>=8?"td"===a.substring(0,2)||"rd"===a.substring(0,2)?"https://www.webstorage-service.com/api/https-json2.php":"https://ondotori.webstorage.jp/api/https-json2.php":void 0}function e(a,b){var c=a.data.header,d=a.data.data.split("\n"),e=d[0].split(",").length,f=d.length,g=[];for(l=0;f-1>l;l++){var h=d[l].split(",");for(j=1;j<e;j++){0===l&&(g[j-1]=[]);var i=isFinite(h[j])?h[j]:null;null!==i?g[j-1].push([parseFloat(h[0]),parseFloat(i)]):g[j-1].push([parseFloat(h[0]),null])}}for(l=0;e-1>l;l++)g[l]=g[l].splice(-b);for(var k=[],l=0;l<c.ch.length;l++){var m={name:c.ch[l].name,num:c.ch[l].num,unit:c.ch[l].unit,data:g[l]};k.push(m)}return{header:c,chs:k}}var f={SUCCESS:"2000",SERVER_ERROR_DB:"4000",SERVER_ERROR_FILE:"4001",AUTH_ERROR:"5000",FILE_ID_NOT_FOUND:"5001",FILE_READ_ERROR:"5002",FILE_OVERFLOW:"5003",FILE_DOWNLOAD_SIZE_OVERFLOW:"5004",PARAMETER_ERROR:"9000"};b.comm.ws.RESPONSE_CODE=f,b.comm.ws.getCurrent=a,b.comm.ws.getCurrentGraphData=c}()}(this),function(a){var b={};a.TANDD.dataserver=b,b.env={version:"1.1.1"};var c={LOCALSTORAGE_SETTINGS_KEY:"ds_settings",API:{URI:"/",PATH_LEGACY:"tdds-api1",PATH_ENV:"api/env/",TIMEOUT:1e4,PATH_CHART_VALUE:"api/chart-value/"},DEFAULT:{UPDATE_INTERVAL:180,GRAPH_PLOTS:100,LIST_SORT_ORDER:"name"},CHTYPE:{TEMP:13,HUM:208,HUMH:209}},d={},e={list_data:[],view_data:[],last_connect_time:null},f={},g={no:0,domid:"",selected_serial:""},h=null;$(document).bind("pagechange",function(a,b){g.domid=b.toPage.attr("id")}),$(document).on("pagebeforecreate","#page_top",function(a,c){d=b.settings.get(),b.util.loadLanguageResource(d.international.lang)}),$(document).on("pageinit","#page_top",function(a,c){$("#javascript_error_message").hide(),$("#logger_content").html("<div data-i18n='MSG_NO_ITEMS'>"+$.i18n.prop("MSG_NO_ITEMS")+"</div>"),$("#start_date").text(b.util.getDateString(new Date)),b.comm.updateCurrent(),$(document).delegate("#updateCurrent","click",function(){b.comm.updateCurrent()}),$("#page_top").bind("pageshow",function(a,c){b.util.timer.start()}),$("#page_top").bind("pagehide",function(a,c){b.util.timer.stop()}),$("#sidemenu").bind("panelbeforeopen",function(a,b){}),TANDD.env.ua.isIE&&(TANDD.env.ua.ie.eq_IE9||TANDD.env.ua.ie.eq_IE8)||(Waves.attach(".btn-circle",["waves-circle"]),Waves.attach(".btn-square",["waves-button"]),Waves.attach(".btn-block",["waves-block"]),Waves.attach(".list_item",["waves-block"]),Waves.init(),(new WOW).init()),b.comm.getServerEnv().done(function(a,b,c){if("undefined"!=typeof a.applicationName&&"undefined"!=typeof a.applicationVersion){var d=a.applicationName+" Ver. "+a.applicationVersion;$("#applivation_with_version").text(d)}if("undefined"!=typeof a.hostName){var e="("+a.hostName+")";$("#hostname").text(e)}}).fail(function(a,b,c){}).always(function(){})}),$(document).on("pageinit","#page_graph",function(a,c){$("#page_graph").bind("pageshow",function(a,c){if(""===g.domid&&""===g.selected_serial)return void $(":mobile-pagecontainer").pagecontainer("change",$("#page_top"),{transition:"slide"});var d=b.util.getDevinfoBySerial(e.list_data,g.selected_serial);b.view.graph.create(d),b.util.timer.start(),$(window).bind("resize",function(a,c){b.view.graph.resize()}),$("#updateGraph").bind("click",function(a,c){b.comm.updateCurrentGraph(g.selected_serial)}),TANDD.dataserver.comm.getChartValue(d.serial)}),$("#page_graph").bind("pagehide",function(a,c){b.util.timer.stop(),$(window).unbind("resize"),b.view.graph.destruct(),$("#updateGraph").unbind("click")}),$("#plot_test").click(function(){var a={ch:[{last_data:(new Date).getTime()/1e3,value:1310,type:13},{last_data:(new Date).getTime()/1e3,value:1320,type:13}],time_diff:540};b.view.graph.addPlots(a)})}),$(document).on("pageinit","#page_set_display",function(a,c){$("#button-display-apply").bind("click",function(){b.form.applyDisplaySettings()}),$("#page_set_display").bind("pagebeforeshow",function(a,c){"ja"===d.international.lang?($("#temp-unit-column").css("display","none"),$("#summertime-column").css("display","none")):($("#temp-unit-column").css("display","block"),$("#summertime-column").css("display","block")),b.form.setInitialDisplaySettingsValue()})}),$(document).on("pageinit","#page_set_lang",function(a,c){$("#page_set_lang").bind("pagebeforeshow",function(a,c){b.form.setInitialLangSettingsValue()}),$("#button-lang-apply").bind("click",function(){b.form.applyLangSettings()})}),b.comm={},function(){function a(){$.mobile.loading("show"),b.util.timer.stop(),b.comm.wf7.devinfoAll().done(function(a,c,d){"result"in a?0===a.result?(0!==a.data.length&&b.view.updateCurrentView(e.view_data),b.util.hasWarningLogger(a.data)&&b.view.jqmMessage($.i18n.prop("MSG_WARNIG_OCCURRED")),b.view.updateCurrentView(e.view_data),e.view_data.length>=2&&b.view.updateSwiperView(e.view_data,g.no)):b.view.jqmMessage($.i18n.prop("MSG_COMM_FAILURE_WITH_ERROR_CODE",a.result)):b.view.jqmMessage($.i18n.prop("MSG_COMM_FAILURE"))}).fail(function(a,c,d){b.view.jqmMessage($.i18n.prop("MSG_COMM_FAILURE"));var e="";a.statusText&&(e+=a.statusText),a.responseText&&(e+="\n\n"+a.responseText)}).always(function(){$.mobile.loading("hide"),b.util.timer.start()})}function h(a){$.mobile.loading("show"),b.util.timer.stop(),b.comm.wf7.devinfoAll().done(function(c,d,e){var f=b.util.getDevinfoBySerial(c.data,a);f&&(b.view.graph.addPlots(f),b.view.graph.updateCurrentPanel(f))}).fail(function(a,b,c){}).always(function(){$.mobile.loading("hide"),b.util.timer.start()})}function i(a){var b=c.API.URI+c.API.PATH_ENV,d=$.extend({},$.ajaxSettings,a,{type:"POST",url:b,dataType:"json",timeout:c.API.TIMEOUT}),e=$.ajax(d),g=$.Deferred();return e.done(function(a,b,c){f=a,g.resolveWith(this,arguments)}),e.fail(function(a,b,c){g.rejectWith(this,arguments)}),e.always(function(){}),$.extend({},e,g.promise())}function j(a){var e=parseInt((new Date).getTime()/1e3),f=e-604800,g={serial:a,limit:d.current_readings.graph_plots,first:f},h=c.API.URI+c.API.PATH_CHART_VALUE,i=$.extend({},$.ajaxSettings,{type:"POST",url:h,dataType:"json",data:JSON.stringify(g),timeout:c.API_TIMEOUT}),j=$.ajax(i),k=$.Deferred();return j.done(function(a,c,d){200===a.status&&b.view.graph.updateChart(a.result),k.resolveWith(this,arguments)}),j.fail(function(a,b,c){k.rejectWith(this,arguments)}),j.always(function(){}),$.extend({},j,k.promise())}b.comm.updateCurrent=a,b.comm.updateCurrentGraph=h,b.comm.getServerEnv=i,b.comm.getChartValue=j}(),b.comm.wf7={},function(){function a(a){var d={cmd:"devinfo",timefmt:"local",conv:"raw",param:{dev:"all"}},f=c.API.URI+c.API.PATH_LEGACY,g=$.extend({},$.ajaxSettings,a,{type:"POST",url:f,dataType:"json",data:JSON.stringify(d),timeout:c.API_TIMEOUT}),h=$.ajax(g),i=$.Deferred();return h.done(function(a,c,d){e.list_data=a.data,e.view_data=b.view.devinfo2ViewData(a.data),e.last_connect_time=new Date,i.resolveWith(this,arguments)}),h.fail(function(a,b,c){i.rejectWith(this,arguments)}),h.always(function(){}),$.extend({},h,i.promise())}b.comm.wf7.devinfoAll=a}(),b.view={},function(){function a(a,b){"undefined"!=typeof b&&(b=1200),new $.nd2Toast({message:a,action:{title:"OK",fn:function(){},color:"lime"},ttl:b})}function c(){null==h&&(h=new Swiper(".swiper-container",{slidesPerView:3,spaceBetween:10,centeredSlides:!0,keyboardControl:!0,breakpoints:{320:{slidesPerView:2,spaceBetween:10},480:{slidesPerView:2,spaceBetween:10},640:{slidesPerView:2,spaceBetween:10},1024:{slidesPerView:2,spaceBetween:10}},onClick:function(a,b){b.preventDefault(),g.no=a.clickedIndex,a.slideTo(a.clickedIndex)},onSlideChangeEnd:function(a){g.no=a.activeIndex,b.settings.setLastPageNo(a.activeIndex);for(var c=$(a.slides[a.activeIndex]).children("div"),d=0;d<a.slides.length;d++){var c=$(a.slides[d]).children("div");d===a.activeIndex?c.addClass("baseunits_menu_active"):c.removeClass("baseunits_menu_active")}b.view.updateCurrentView(e.view_data)}}))}function f(a,b){c(),h.removeAllSlides();for(var d=0;d<a.length;d++){var e="";e+='<div class="swiper-slide"><div class="baseunits_menu',b===d&&(e+=" baseunits_menu_active"),e+='">',e+=a[d].name,e+="</div></div>",h.appendSlide(e)}h.update(),h.slideTo(b)}function i(a){if(0!==a.length){var c=a[g.no].group;$("#logger_content").html("");var d=0;$.each(c,function(){var a=d++,c="group"+a;""!=this.name&&$("#logger_content").append("<h2 class='group_name'>"+this.name+"</h2>"),$("#logger_content").append("<ul data-role='listview' data-inset='true' id='"+c+"'></ul>"),$("#"+c).listview(),$.each(this.loggers,function(){var a=(this.num,this.serial),d=this.serial,e="";null!=this.ch[0].last_data&&isFinite(this.ch[0].last_data)&&(e=b.util.unixtime2DateString(this.ch[0].last_data,this.time_diff)),$("#"+c).append("<li id='"+d+"'><h3 class='remote_unit'>"+this.name+"</h3></li>");var f,h=this.ch.length;if(1==h)f="<p class='logger_ch'>"+j(this.ch[0],h)+"</p>";else if(h>=2&&3>=h)f="<p class='logger_ch'>",$.each(this.ch,function(){f+=j(this,h),this.num<h&&(f+="<span style='font-size: 18px;'>&nbsp;/&nbsp;</span>")}),f+="</p>";else if(6==h){var i=j(this.ch[0],h)+"&nbsp;(&nbsp;"+j(this.ch[4],h)+"&nbsp;)",k=j(this.ch[1],h)+"&nbsp;(&nbsp;"+j(this.ch[5],h)+"&nbsp;)",l=j(this.ch[2],h)+"<span style='font-size: 12px;'>&nbsp;/&nbsp;</span>"+j(this.ch[3],h);f="<p class='logger_ch'>"+i+"</p><p>"+k+"</p><p>"+l+"</p>"}else f="Not supported.";var m="<p class='logger_serial'>("+TANDD.products.getModelName(a)+": "+a+")</p>",n="<p class='logger_date'>"+e+"</p>",o="<p class='logger_state_icon'>";if(isFinite(this.battery)){var p=parseInt(this.battery,10);o+='<img src="images/icon/battery/battery'+p+'.png" width="30" height="30">'}o+="</p>",$("#"+d).append(f+n+m+o);var q=TANDD.products,r=q.getModelCode(this.serial);r!==q.MODEL_CODE.TR41&&r!==q.MODEL_CODE.TR42&&r!==q.MODEL_CODE.TR45&&($("#"+d).wrapInner("<a href='#page_graph' class='ui-link-inherit' data-transition='slide'></a>"),$("#"+d).bind("click",function(){g.selected_serial=$(this).attr("id")})),$("#"+c).listview("refresh")})});var f="<div class='update_timestamp'><p>"+$.i18n.prop("LABEL_LAST_CONNECT_TIME")+": <span id='last_connect_time'>"+b.util.getDateString(e.last_connect_time)+"</span></p></div>";$("#logger_content").append(f)}}function j(a,c){var e,f;switch(c){case 1:e="ch_value",f="ch_unit";break;case 2:e="ch_value_small",f="ch_unit_small";break;case 6:5==a.num||6==a.num?(e="ch_value_xsmall",f="ch_unit_xsmall"):(e="ch_value_small",f="ch_unit_small");break;default:e="ch_value_small",f="ch_unit_small"}if("sensor"===a.warn_status)return"<span style='ch_unit_xsmall'>----</span>";actual_value=b.util.rawData2Actual(a.value,a.type,d.temp_unit),"upper"===a.warn_status?e+=" ch_value_warning_upper":"lower"===a.warn_status&&(e+=" ch_value_warning_lower");var g,h=b.util.getUnitStr(a.type,d.temp_unit);return g="<span class='"+e+"'>"+actual_value+"</span>&nbsp;<span class='"+f+"'>"+h+"</span>"}function k(a){function b(a){a.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0})}function c(a){a.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0})}function e(a){a.sort(function(a,b){return a.serial<b.serial?-1:a.serial>b.serial?1:0})}function f(a){var b=a.substring(0,1);return"E"!==b}function g(a,b){for(var c=0;c<b.length;c++)if(b[c].name===a)return c;return-1}var h={model:"TR-7 Series",name:"TR-7 Series",serial:"",group:[]},i={model:"RT-14/RS-14",name:"RT-14/RS-14",serial:"",group:[]},j={model:"TR4 Series",name:"TR4 Series",serial:"",group:[{name:"",loggers:[]}]},k=TANDD.products;"name"==d.current_readings.list_sort_order?c(a):"serial"==d.current_readings.list_sort_order&&e(a),$.each(a,function(){var a=k.getModelCode(this.serial),b=(this.time_diff,this);switch(a){case k.MODEL_CODE.TR71WF:case k.MODEL_CODE.TR71NW:case k.MODEL_CODE.TR72WF:case k.MODEL_CODE.TR72NW:case k.MODEL_CODE.TR75WF:case k.MODEL_CODE.TR75NW:case k.MODEL_CODE.TR71WB:case k.MODEL_CODE.TR72WB:case k.MODEL_CODE.TR75WB:if(f(b.serial)){var c=g(b.group,h.group);-1!=c?h.group[c].loggers.push(b):h.group.push({name:b.group,loggers:[b]})}else{var c=g(b.group,i.group);-1!=c?i.group[c].loggers.push(b):i.group.push({name:b.group,loggers:[b]})}break;case k.MODEL_CODE.TR41:case k.MODEL_CODE.TR42:case k.MODEL_CODE.TR45:j.group[0].loggers.push(b)}});var l=[];return 0!=h.group.length&&(b(h.group),l.push(h)),0!=i.group.length&&(b(i.group),l.push(i)),0!=j.group[0].loggers.length&&l.push(j),l}b.view.jqmMessage=a,b.view.updateSwiperView=f,b.view.updateCurrentView=i,b.view.devinfo2ViewData=k}(),b.view.graph={},function(){function a(a){e(a),$("#updateProgress").after('<div id="graph_canvas" data-role="content" class="ui-content graph_canvas" role="main"></div>'),b.view.graph.resize();var c=g(a),d=i(a);n=[{date:h(a.ch[0].last_data),ch1:d.ch1,ch2:d.ch2}],charts_opt={element:"graph_canvas",data:n,xkey:"date",ykeys:["ch1","ch2"],labels:[a.ch[0].name,a.ch[1].name],lineColors:[c[0],c[1]],resize:!0,hideHover:!0,dateFormat:function(c){return b.util.getDateString(new Date(c),a.time_diff)},xLabelFormat:function(c){return b.util.getDateString(new Date(c),a.time_diff)}},m=new Morris.Line(charts_opt)}function e(a){var c=g(a);$("#graph_title").text(a.name),$("#ch1_value").css("color",c[0]),$("#ch2_value").css("color",c[1]),$("#ch1_name").text(a.ch[0].name),$("#ch1_value").text(b.util.rawData2Actual(a.ch[0].value,a.ch[0].type,d.temp_unit)),$("#ch1_unit").html(b.util.getUnitStr(a.ch[0].type,d.temp_unit)),$("#ch1_datetime").text("("+b.util.unixtime2DateString(a.ch[0].last_data,a.time_diff)+")"),"none"===a.ch[0].warn_status?$("#ch1_warning").css("display","none"):$("#ch1_warning").css("display","block"),$("#ch2_name").text(a.ch[1].name),$("#ch2_value").text(b.util.rawData2Actual(a.ch[1].value,a.ch[1].type,d.temp_unit)),$("#ch2_unit").html(b.util.getUnitStr(a.ch[1].type,d.temp_unit)),$("#ch2_datetime").text("("+b.util.unixtime2DateString(a.ch[1].last_data,a.time_diff)+")"),"none"===a.ch[1].warn_status?$("#ch2_warning").css("display","none"):$("#ch2_warning").css("display","block")}function f(a){var b=!1;if(0===n.length)b=!0;else{var c=n[n.length-1];h(a.ch[0].last_data);c.date!==h(a.ch[0].last_data)&&(b=!0)}if(b){var e=i(a),f={date:h(a.ch[0].last_data),ch1:e.ch1,ch2:e.ch2};n.push(f),0!=d.current_readings.graph_plots&&n.length>d.current_readings.graph_plots&&n.shift(),m.setData(n)}}function g(a){return a.ch[0].type===c.CHTYPE.TEMP&&a.ch[1].type===c.CHTYPE.TEMP?(ch1_color=o.TEMP,ch2_color=o.TEMP2):(ch1_color=o.TEMP,ch2_color=o.HUM),[ch1_color,ch2_color]}function h(a){return 1e3*a}function i(a){var c=b.util.rawData2Actual(a.ch[0].value,a.ch[0].type,d.temp_unit),e=b.util.rawData2Actual(a.ch[1].value,a.ch[1].type,d.temp_unit);return c="----"===c?null:c,e="----"===e?null:e,{ch1:c,ch2:e}}function j(){m=NaN,n=[],$("#graph_canvas").remove(),$("body").attr("oveflow-y","visible")}function k(){var a=$("#graph_header").height(),b=0,c=$("#graph_canvas"),d=$("#current_panel"),e=$("#updateProgress").height(),f=TANDD.env.getDisplaySize();f.height<500||f.width<360?(b=0,d.attr("display","none")):(d.attr("display","block"),b=120),c.width(f.width).height(f.height-a-e-b),d.width(f.width).height(b),$("body").attr("oveflow-y","hidden")}function l(a){if(null!=a&&2==a.channels.length){var e=a.channels[0],f=a.channels[1];if(e.blocks.length==f.blocks.length&&0!=a.channels[0].blocks.length){for(var g=[],i=0,j=e.blocks.length;j>i;++i){var k=e.blocks[i],l=f.blocks[i];if(k.data.length!=l.data.length)return;if(k.interval!=l.interval)return;var o=k.first;k.connect||g.push({date:h(o),ch1:null,ch2:null});for(var p=0,q=k.data.length;q>p;++p){var r=k.data[p],s=l.data[p];k.type===c.CHTYPE.TEMP&&"F"===d.temp_unit&&null!=r&&(r=b.util.tempCnv(r,"CF",!0)),l.type===c.CHTYPE.TEMP&&"F"===d.temp_unit&&null!=s&&(s=b.util.tempCnv(s,"CF",!0)),g.push({date:h(o),ch1:r,ch2:s}),o+=k.interval}n=g}m.setData(g)}}}var m,n,o={TEMP:"#9f2936",TEMP2:"#7f723d",HUM:"#1b587c",CO2:"#4e8542",ILL:"#f07f09",UV:"#604878",C_ILL:"#c19859",C_UV:"#6b9f25"};b.view.graph.create=a,b.view.graph.updateCurrentPanel=e,b.view.graph.addPlots=f,b.view.graph.destruct=j,b.view.graph.resize=k,b.view.graph.updateChart=l}(),b.form={},function(){function a(){var a=$("#update-interval").val(),c=parseInt($("#graph-display-cnt").val()),f=$("#list-sort-order").val(),g=$("#temp-unit").val(),h=$("#summertime").val(),i=b.settings.get();return i.current_readings={update_interval:a,graph_plots:c,list_sort_order:f},i.temp_unit=g,i.summertime="1"===h?!0:!1,b.settings.set(i)?(d=i,b.view.jqmMessage($.i18n.prop("MSG_SETTINGS_SUCCESS")),e.view_data=b.view.devinfo2ViewData(e.list_data),b.view.updateCurrentView(e.view_data),!0):(b.view.jqmMessage($.i18n.prop("MSG_SETTINGS_FAILURE")),!1)}function c(){var a=b.settings.get();$("#update-interval").val(a.current_readings.update_interval),$("#update-interval").selectmenu("refresh"),$("#graph-display-cnt").val(a.current_readings.graph_plots),$("#graph-display-cnt").selectmenu("refresh"),$("#list-sort-order").val(a.current_readings.list_sort_order),$("#list-sort-order").selectmenu("refresh"),$("#temp-unit").val(a.temp_unit),$("#temp-unit").selectmenu("refresh");var c=a.summertime===!0?"1":"0";$("#summertime").val(c),$("#summertime").selectmenu("refresh")}function f(){var a=b.settings.get();$("input[name='set-lang']").val([a.international.lang]),$("input[name='set-lang']").checkboxradio("refresh")}function g(){var a=b.settings.get();return lang=$('input[name="set-lang"]:checked').val(),a.international={lang:lang},"ja"===lang&&(a.temp_unit="C"),b.settings.set(a)?(d=a,b.util.loadLanguageResource(lang),$("#page_set_display").trigger("create"),$("#page_set_lang").trigger("create"),b.view.updateCurrentView(e.view_data),b.view.jqmMessage($.i18n.prop("MSG_SETTINGS_SUCCESS")),!0):(b.view.jqmMessage($.i18n.prop("MSG_SETTINGS_FAILURE")),!1)}b.form.applyDisplaySettings=a,b.form.setInitialDisplaySettingsValue=c,b.form.setInitialLangSettingsValue=f,b.form.applyLangSettings=g}(),b.settings={},function(){function a(){var a,d;try{if(a=localStorage.getItem(c.LOCALSTORAGE_SETTINGS_KEY))d=JSON.parse(a);else{var e=TANDD.env.getLanguage();"undefined"===e&&(e="en"),d={current_readings:{update_interval:c.DEFAULT.UPDATE_INTERVAL,graph_plots:c.DEFAULT.GRAPH_PLOTS,list_sort_order:c.DEFAULT.LIST_SORT_ORDER},international:{lang:e},temp_unit:"C",summertime:!1},b.settings.set(d)}}catch(f){d=null}return d}function d(a){try{localStorage.setItem(c.LOCALSTORAGE_SETTINGS_KEY,JSON.stringify(a))}catch(b){return!1}return!0}function e(){var a;try{return a=localStorage.getItem("last_page_no"),a?parseInt(a):0}catch(b){return 0}}function f(a){try{localStorage.setItem("last_page_no",a)}catch(b){return!1}return!0}b.settings.get=a,b.settings.set=d,b.settings.getLastPageNo=e,b.settings.setLastPageNo=f}(),b.util={},function(){function a(a){$.i18n.properties({name:"WebviewerMessages",path:"./i18n/",mode:"both",language:a,callback:function(){var a=document.querySelectorAll("[data-i18n]");for(i=0;i<a.length;i++){var b=$(a[i]).data("i18n"),c=$.i18n.prop(b);$(a[i]).html(c)}}})}function f(a){var b=new jsSHA(a,"TEXT");return b.getHash("SHA-1","HEX")}function h(a,b,d){d=d||"C";var e;return b===c.CHTYPE.TEMP||b===c.CHTYPE.HUM||b===c.CHTYPE.HUMH?61166===a?"----":(32768&a&&(a=-(a-1^65535)),e=(a-1e3)/10,b===c.CHTYPE.TEMP&&"F"===d&&(e=j(e,"CF",!0)),l(e,b)):null}function j(a,b,c){c=c||!1;var d;return"FC"==b?(d=5*(a-32)/9,c&&(d=k(d))):d=c?k(k(1.8*a)+32):1.8*a+32,d}function k(a){return Math.floor(10*a)/10}function l(a,b){return""===a||isNaN(Math.floor(a))?null:b==c.CHTYPE.HUM?Math.floor(a):k(a).toFixed(1)}function m(a,b){var c="";return 13===a?c="C"===b?"&deg;C":"&deg;F":(208===a||209===a)&&(c="%"),c}function n(a,b){var c=$.grep(e.list_data,function(a,b){return a.serial===g.selected_serial});return 0===c.length?null:c[0]}function o(a){if(!(a instanceof Array))return!1;if(0===a.length)return!1;for(var b=0;b<a.length;b++)for(var c=0;c<a[b].ch.length;c++)if("none"!=a[b].ch[c].warn_status)return!0;return!1}function p(a,b){var c=d.summertime?60:0,e=TANDD.util.date.unixtime2DateString(a,b,c);return e}function q(a,b){var c=0;"undefined"==typeof b?(b=TANDD.util.date.getTZoff(),c=0):c=d.summertime?60:0;var e=TANDD.util.date.getDateString(new Date(a),b,c);return e}b.util.loadLanguageResource=a,b.util.getSHA1Hash=f,b.util.rawData2Actual=h,b.util.tempCnv=j,b.util.getUnitStr=m,b.util.getDevinfoBySerial=n,b.util.hasWarningLogger=o,b.util.unixtime2DateString=p,b.util.getDateString=q}(),b.util.timer={},function(){function a(){e||(f=100,e=setInterval(function(){f-=100/d.current_readings.update_interval,$(".loadie").width(f+"%"),0>f&&("page_top"===g.domid?b.comm.updateCurrent():"page_graph"===g.domid&&b.comm.updateCurrentGraph())},1e3))}function c(){clearInterval(e),e=null}var e=null,f=0;b.util.timer.start=a,b.util.timer.stop=c}()}(this);